{"./":{"url":"./","title":"《图解TCP/IP》第 5 版笔记","keywords":"","body":"《图解TCP/IP》笔记 本书旨在让广大读者理解 TCP/IP 的基本知识，掌握 TCP/IP 的基本技能 在线笔记 Github Pages Gitee Pages 国内访问更快 目录 第 1 章 网络基础知识 第 2 章 TCP/IP 基础知识 第 3 章 数据链路 powered by Gitbook更新时间： 2020-09-10 19:26:56 "},"md-note/01-web_base.html":{"url":"md-note/01-web_base.html","title":"第 1 章 网络基础知识","keywords":"","body":"第 1 章 网络基础知识 计算机与网络发展历史及标准化过程、OSI参考模型、网络概念本质、网络构件的设备 计算机网络出现的背景 起初，计算机以单机模式被广泛使用，也叫独立模式，即未连接到网络、各自独立使用的方式 将一个个计算机连接在一起，即形成计算机网络，根据规模分为 WAN（Wide Area Network，广域网） 和 LAN（Local Area Network，局域网） 最初是由管理员将特定的几台计算机连到一起形成计算机网络，是私有的网络，后来人们不断尝试将私有网络相互连接形成更大的私有网络，之后又逐渐演变成为互联网，互联网中的任何两台计算机都能通信，再后来各种各样的终端都接入互联网，形成现在的综合通信环境。 计算机网络就好比人的神经系统，神经能将各处的感觉传递到大脑，网络能将世界各地的信息传递到你的计算机中。 计算机与网络发展的 7 个阶段 了解计算机与网络发展的历史与现状，能更好的理解 TCP/IP 的重要性 年代 内容 20 世纪 50 年代 批处理时代 20 世纪 60 年代 分时系统时代 20 世纪 70 年代 计算机间通信时代 20 世纪 80 年代 计算机网络时代 20 世纪 90 年代 互联网普及时代 2000 年 以互联网为中心的时代 2010 年 无论何时何地一切皆 TCP/IP 的网络时代 批处理（Batch Processing） 20 世纪 50 年代 事先将用户程序和数据装入卡带或磁带，并由计算机按照一定的顺序读取，使用户所要执行的这些程序和数据能够一并批量得到处理的方式 这种计算机价格昂贵体积巨大，通常放置于专门进行计算机管理于运维的计算机中心，用户除了事先将程序和数据装入卡带或磁带带到中心去运行之外别无他法 操作相当复杂，有专门的操作员负责实际运行程序，用户较多时只能过些时日再来取结果 彼时的计算机主要用于大规模计算或处理，不是普通人使用的工具 分时系统（Time Sharing System，TSS） 20 世纪 60 年代出现 多个终端（由键盘、显示器等输入输出设备组成）与同一个计算机连接，允许多个用户同时使用一台计算机的系统（原理与 CPU 的多任务调度同） 彼时计算机造价昂贵，无法一人一台，分时系统则可以假装“一人一台”，用户感觉“完全是自己在使用一台计算机”，这体现了分时系统的独占性 分时系统的重要特性：多路性、独占性、交互性、及时性 它的交互式（对话式）操作使计算机变得更加人性化，并且促进了像 BASIC 这样能够与计算机实现交互的编程语言的发展，而在此之前的 COBOL 和 FORTRAN 等计算机编程语言都必须以批处理系统为基础才能开发和运行 BASIC 语言的发明是为了让更多的人学习如何编程，可以说是关注分时系统的初学者们的必学语言 此时每个终端与计算机之间通信线路构成了星型结构，从这时开始，网络通信与计算机之间的关系开始显现。小型机随集产生，办公场所与工厂也逐渐引入计算机 分时系统中一个计算机与多个终端使用通信线路连接，但两个计算机之间还是无法连接 计算机之间的通信 20 世纪 70 年代，计算机性能飞速发展，体积小型化，价格急剧下降，企业也开始使用，为了提高工作效率，人们开始研究计算机之间的通信技术 计算机之间通信技术诞生前，计算机间转移数据需要使用磁带、软盘等外部存储介质 计算机网络的产生 20 实际 80 年代 能够连接各式各样的计算机的网络诞生 窗口系统的发明让人们更加便捷的使用计算机，拉近与网络的距离，开始愉快的网上冲浪，享受网上的丰富资源 互联网的普及 20 世纪 90 年代 连接异构型计算机的通信网络技术就是现在的互联网技术，此时万维网（World Wide Web，WWW）等信息传播方式也迎来了大发展，互联网进入每个家庭内部 瘦身 20 世纪 90 年代上半叶，由于使用个人电脑与 UNIX 工作站搭建网络比大型主机更有优势，操作简单且价格低廉，由此引发了一个旨在降低网络架构成本的新趋势，被称为“瘦身” 以互联网技术为中心的时代 许多发展道路各不相同的网络技术都向互联网靠拢。 例如，电话网曾经一直作为通信基础设施、支撑通信网络，其地位目前已被 IP（Internet Protocol）网所取代，而 IP 网本身就是互联网技术的产物。通过 IP 网，不仅可以实现电话通信、电视播放，还能实现计算机间的通信，建立互联网。而且能联网的设备也是扩展到了各种电子产品。 从“单纯简历连接”到“安全简历连接” 互联网给了我们高度便捷的信息网络环境，正成为社会基础设施建设中最基本的要素之一，但其也带来了负面问题，如计算机病毒、信息泄露、网络欺诈等等。 故而现在人们更加追求安全建立连接 手握金刚钻的 TCP/IP 能够使许多独立发展的网络通信技术融合并实现统一的正是 TCP/IP 技术，它是通信协议的统称 协议 TCP/IP 是一种网络体系结构，是 IP、TCP、UDP、HTTP、SMTP 等一系列协议的集合，主要用于互联网、局域网。此外也有很多其他类型的网络体系结构以及协议 协议就是计算机之间通信时实现达成的一种约定，可以使得不同设备、CPU（Central Processing Unit）、操作系统（Operating System，OS）都可以实现通信 例如平常聊天中，使用的语言就是协议，聊天就是通信，而说话的内容就是要传递的数据，只有两人协议相同时才能完成聊天 分组交换协议 将大数据分割成一个个称为包（Packet）的较小单元进行传输的方法 在每一个分组中附加源主机地址和目标主机地址送给通信线路，这些发送端地址、接收端地址以及分组序号写入的部分称为报文首部，这都已经规定在通信协议中 协议由谁指定 最初各大厂商都有自己的通信协议和网络体系结构，互不兼容，即使物理层面上连接了也无法实现通信，后面才逐渐意识到兼容性的重要意义 ISO（International Organization for Standardization，国际标准化组织）制定了国际标准 OSI（Open Systems Interconnection，开放式通信系统互联参考模型）对通信系统进行标准化，虽然 OSI 所定义的协议没有得到普及，但其设计之初作为指导方针的 OSI 参考模型却常被用于网络协议的制定当中 本书讲述的 TCP/IP 不是由 ISO 制定的某种国际标准，而是由 IETF（Internet Engineering Task Force）所建议、推进的一种协议，它作为互联网上的一种标准，也作为业界标准（非国家或公共机构指定的，但业界公认） 协议得以标准化使得各种设备可以相互通信，推动了计算机网络的普及 标准化 不同厂商的异构产品之间具有兼容性、便于使用的规范化过程 标准化组织分类： 国际标准化组织：ISO、ITU-T 等 国家级标准化机构：日本的 JISC 等 民间团体：如促进互联网协议标准化的 IETF 协议分层与 OSI 参考模型 OSI 参考模型将通信协议中必要的功能分成 7 层，上下层之间交互时遵循的约定称为接口，同一层之间的交互遵循的约定称为协议 OSI 的分层可以将每个层独立使用，避免异常扩大影响，可以构造一个扩展性和灵活性都很强的系统；分层后易于单独实现每个分层的协议，界定具体责任和义务；但是其也有过分模块化、处理变得更加沉重、每个模块不得不实现相似的处理逻辑等问题 理解分层的例子：打电话 序号 分层名称 功能 7 应用层 针对特定应用的协议，如文件传输、电子邮件、远程登录等 6 表示层 设备固有数据格式和网络标准数据格式的转换，应用信息转换网络格式或网络数据转换为应用要用的格式，保证同一比特表示不同意思的不同设备之间的正常通信，就是这一层的主要作用 5 会话层 通信管理，负责建立和断开通信连接，以及数据的分割等数据传输相关的管理 4 传输层 管理两个节点之间的数据传输，负责可靠传输，旨在通信双方节点上进行处理，无序在路由器上处理 3 网络层 地址管理与路由选择，将数据传输到目标地址 2 数据链路层 互联设备之间传送和识别数据帧，物理层面上的通信传输 1 物理层 以 0、1 代表电压高低。界定连接器和网线的规格 OSI 参考模型通信处理举例 每个分层上，在处理由上一层传来的数据时都可以附上当前层的协议所必须的首部信息。接收端对收到的数据进行首部和内容的分离，再转发给上一层 会话层决定建立连接和断开的时机，而传输层负责进行实际的建立和断开处理 TCP/IP 中，网络层与传输层相互协作以确保数据报能够传送到，实现可靠传输 相互直连的设备之间使用 MAC（Media Access Control，介质访问控制）地址（物理地址、硬件地址）实现传输，可以识别连接到同一传输介质上的设备 传输方式的分类 面向有连接型和面向无连接型 面向有连接型中，必须在通信传输前后，专门进行建立和断开连接的处理。如果无法通信就可以避免发送无谓的数据 面向有连接型情况下，发送端数据不一定要分组发送，TCP 是面向有连接型分组发送数据的，而电路交换属于面向有连接型且不仅限于分组发送数据的 面向无连接型无需建立和断开连接，发送端可于任何时候自由发送数据 面向无连接型采用分组交换情况多些，此时可以直接将数据理解为分组数据 电路交换和分组交换 网络通信方式大致分为两种：电路交换、分组交换。电路交换主要用于过去的电话网，分组交换则是 TCP/IP 采用的通信方式 电路交换中，交换机主要负责数据的中转处理。计算机先连接到交换机，交换机之间由众多通信线路连接。计算机间发送数据时，需要通过交换机与目标主机建立通信电路，建立好连接电路后，用户就可以一直使用这条电路，直到连接被断开为止 电路交换的问题：如果多个计算机连接到了一条电路，那么别的计算机只有等当前独占电路的计算机处理结束后才能使用电路，但谁知道他什么时候开始什么时候结束呢。而且当并发用户数超过交换机之间通信线路数时，那么通信根本无法实现 分组交换，计算机将要发送的数据分成多个数据包，按照一定顺序排列后分别发送。所有的计算机可以一起收发数据，提高了通信线路的利用率 路由器收到分组数据时先放到缓冲区中，再以先进先出的规则逐一发送（有时也会优先发送目标地址特殊的数据），因此分组交换也叫蓄积交换 分组交换中路由器之间通常只有一条线路，作为共享线路使用。电路交换中计算机之间的数据传输速度是不变的，分组交换中的传输速度与网络拥堵情况有关，且当路由器缓存饱和或溢出时，甚至可能会发生分组数据丢失、无法发送到对端的情况。 根据接收端数量分类 单播（Unicast） 1 对 1 通信，如早先的固定电话 广播（Broadcast） 将消息从 1 台主机发送给与之相连的所有其他主机，例如电视播放 广播域：只有在某个范围内的计算机才能收到相应的广播消息，类似于电视信号的频段 多播（Multicast） 类似于广播也是传给多个主机，但是是限定某一组主机，例如电视会议 任播（Anycast） 在特定的多台主机中选出一台作为接收端，例如DNS 根域名解析服务器 地址 每一层协议所使用的地址都不尽相同 唯一性 一个地址必须明确地表示一个主体对象，同一个通信网络中不允许有两个相同地址的通信主题存在 不过这个主体对象不是说单个对象，比如特定的某组主机共同有个地址，也是行的，比如说多播那种，再比如互联网研发部的所有同学 层次性 MAC 地址不具有层次性，IP 地址除了具有唯一性还具有层次性 MAC 地址中的制造商识别号、产品编号等也具有一定的层次性，但那是制造商管理上的，不是殉职过程中的层次性，所以在网络领域的地址来看它不具有层次性 IP 地址的分层通过网络号、主机号实现 网络传输中，节点根据一个表来确定报文改由哪个网卡发出。MAC 寻址参考地址转发表，IP 寻址参考路由控制表。计算机、路由器使用 IP 寻址发送数据，交换机使用 MAC 寻址发送数据 网络的构成要素 通信媒介与数据链路 计算机之间通过电缆相互连接，电缆分为双绞线电缆、光纤电缆、同轴电缆、串行电缆等 媒介有电波、微波等 传输速率：两个设备之间数据流动的物理速度，单位 bps（Bits Per Second，每秒比特数），又称为带宽（Bandwidth） 吞吐量：主机之间实际的传输速率，单位与带宽相同，不仅衡量带宽，也同时衡量主机的 CPU 处理能力、网络拥堵程度、报文中数据占比等信息 网卡 Network Interface Card，NIC 计算机连接网络所必须的部件 中继器 Repeater OSI 第 1 层——物理层上延长网络的设备，把信号进行调整和放大后继续传输下去 有些中继器还能实现不同类型信号的转换，如连接同轴电缆和光缆的中继器 中继器两侧连接的必须是相同传输速度的媒介 中继器不能无限使用 多个端口的中继器也被称为中继集线器或集线器 网桥/2 层交换机 在 OSI 模型第 2 层——数据链路层层面上连接两个网络的设备，能识别数据链路层中的数据帧，并存储之，再重新生成信号作为一个全新的帧发送给相连的另一个网段 网桥根据数据帧的内容转发数据给相邻的其他网络，有完整性校验 网桥没有连接网段个数的限制 网桥基本上只用于连接相同类型的网络，有时也可以连接不同传输速率的网络 网桥还能通过地址自学机制和过滤功能控制网络流量 具有网桥功能的 Hub 叫做交换集线器，常被直接称为 Hub，只有中继功能的 Hub 叫集线器 路由器/3 层交换机 OSI 模型的第 3 层——网络层上面连接两个网络、并对分组报文进行转发的设备 网桥根据 MAC 地址进行处理，而路由器根据 IP 地址进行处理，因此网络层中的地址是 IP 地址 可以连接不同的数据链路 可以分带网络负荷，甚至能带有一定的网络安全功能 4~7 层交换机 处理 OSI 模型中从传输层至应用层的数据 例如大型网站的负载均衡器 带宽控制功能：网络拥堵时优先处理语音、放缓处理邮件 网关 协议的转换和数据的转发 同一种协议之间转发数据的叫做应用网关 OSI 参考模型中负责将从传输层到应用层的数据进行转换和转发的设备 代理服务器（Proxy Server）就是网关的一种，称为应用网关 现代网络实态 构成 高速路由器组成核心网（骨干网），多功能路由器和 3 层交换机组成边缘网络，再往下是接入层（汇聚层） 通信 手机开机就会自动与距离最近的基站发生无线通信，基站就相当于网络的接入层 powered by Gitbook更新时间： 2020-09-09 02:54:55 "},"md-note/02-TCP:IP_base.html":{"url":"md-note/02-TCP:IP_base.html","title":"第 2 章 TCP/IP 基础知识","keywords":"","body":"第 2 章 TCP/IP 基础知识 Transmission Control Protocol、Internet Protocol TCP/IP 出现的背景及其历史 20 世纪 60 年代，以美国国防部（The Department of Defense，DoD）为中心的组织开始着力于研究新的通信技术。希望在通信传输中，即使遭到了敌方的攻击破坏，也可以经过迂回线路实现最终通信，分组交换技术应运而生 ARPANET（Advanced Research Projects Agency Network，阿帕网）是他们实验的网络，并取得超前的成功，证明了分组交换技术的通信方法是可行的，它是互联网的鼻祖 ARPANET 中的一个研究机构于 20 世纪 70 年代前半叶研发出了 TCP/IP，到 1982 年具体规范被确定，1983 年成为 ARPANET 网络中唯一指定的协议。1980 年在使用 ARPANET 的大学、机构中出现 BSD UNIX，它实现了 TCP/IP 协议，随着 UNIX 工作站的普及，TCP/IP 也迎来盛行之时。 TCP/IP 的标准化 TCP/IP 是一系列协议的统称，如 IP 与 ICMP、TCP 与 UDP、TELNET 与 FTP、HTTP 等。也称为网际协议族（Internet Protocol Suite） TCP/IP 标准化过程中特点： 具有开放性：由允许任何人加入的 IETF 讨论制定 注重实用性：实现真正能够通信的技术的重要性大于制定某一协议的规范本身。大致规范定下后就开始实现协议进行通信，发现问题讨论修改 RFC（Request For Comment），记录了 IETF 需要讨论、已经讨论的各种协议的文档 IP 协议由 RFC279 制定 TCP 协议由 RFC793 制定 扩展、修改已有协议都要新建 RFC，比较麻烦，因此采用 STD（Standard）方式管理编号。STD 用来记载哪个编号制定哪个协议，即使协议规范内容改变也不会改变 STD 编号，只是其中记录的 RFC 编号视情况增减即可 IETF 每年组织 3 次会议，平时都是通过邮件组形式进行讨论，且邮件组不限制订阅 TCP/IP 标准化流程 互联网草案阶段，有效期 6 个月，否则自动消除 经 IESG（IETF Engineering Steering Group，由 IETF 主要成员构成）批准编入 RFC 文档进入提议标准（Proposed Standard，也是此文档的名称）阶段 协议从上一阶段开始被众多设备应用，如能得到 IESG 认可，即能成为草案标准（Draft Standard），如遇到问题则在此之前修订 更多地设备实现和应用此协议，且所有参与该协议指定的人都觉得它“实用性强，没有什么问题”，并得到 IESG 最终批准，即可以成为标准 互联网基础知识 指由 ARPANET 发展而来、互连全世界的计算机网络，其英文单词 The Internet 也成为固有名词，而 Internet 现在一般指网际网 与 TCP/IP 的关系：TCP/IP 本就是为使用互联网而开发指定的协议族，互联网的协议就是 TCP/IP，TCP/IP 就是互联网的协议 连接全世界的互联网是由很多区域网络组成的，区域网络又由更小的区域网络或机构内部网络构成。每个网络都由骨干网（BackBone）和末端网（Stub）组成。每个网络之间通过 NOC（Network Operation Center，网络操作中心）相连。如果网络运行商不同，网络连接方式、使用方法也会不同，连接异构网络需要 IX（Internet Exchange，网络交换中心）的支持。互联网就是众多异构网络通过 IX 互连的一个巨型网络 TCP/IP 协议分层模型 与 OSI 参考模型对比 硬件（物理层） 负责数据传输的硬件，如以太网或电话线路等，把各种设备连起来 网络接口层（数据链路层） 此层也可以与硬件层合成网络通信层 此层利用硬件来进行通信，可以类比为驱动程序，有了硬件要有软件才能工作 互联网层（网络层） 此层使用 IP 协议，相当于 OSI 参考模型中的第 3 层网络层，IP 协议基于 IP 地址转发分包数据，IP 协议的作用是将分组数据包发送到目的主机 连接互联网的所有主机、路由器都必须实现 IP 的功能，其他网络设备如网桥、中继器或集线器则不必须实现 IP 跨越网络传送数据包，使整个互联网都能收到数据的协议，此期间使用 IP 地址作为主机标识，不具有重发机制，属于非可靠性传输协议 ICMP IP 数据包发送途中出现异常无法到达目的地时，要给发送端一个异常通知，有时被用于诊断网络健康状况 ARP 从分组数据包的 IP 地址中解析出 MAC 地址的协议 传输层 让应用程序之间实现通信，区分计算机中的不同程序使用的是端口号 TCP 面向有连接的传输层协议，保证双端通信主机之间通信可达，能正确处理丢包、乱序等情况 TCP 能有效利用带宽，缓解网络拥堵 为了建立和断开连接，有时需要至少 7 次的收发包，导致流量的浪费，而且为了提高网络利用率，其中定义了各种复杂规范，因此不利于视频会议（视频、音频的数据量既定）等场合 UDP 面向无连接的传输层协议，常用于分组数据较少或多播、广播通信及视频通信等多媒体领域 应用层（会话层以上的分层） TCP/IP 多应用于客户端/服务器架构中，客户端发送请求给服务器，并接收来自服务器的响应 WWW 浏览器通过 HTTP（HyperText Transfer Protocol）与服务端通信，主要传输 HTML（HyperText Markup Language）数据，WWW 中的 HTTP 属于 OSI 应用层的协议，而 HTML 属于表示层的协议 E-Mail 使用 SMTP（Simple Mail Transfer Protocol）协议，最初只能发送文本格式，后由 MIME 协议扩展后就可以发送声音、图像、带格式文字等信息，这里的 MIME 即属于 OSI 参考模型的第 6 层——表示层的协议 文件传输（FTP） File Transfer Protocol，用于文件传输，传输过程中可以选择用二进制方式或文本方式。而文本方式在不同操作系统之间进行时，会自动修改换行符，这也属于表示层的功能 在 FTP 传输过程中会建立两个 TCP 连接，分别为控制连接和数据连接，这两种连接的控制管理属于会话层的功能 远程登录（TELNET、SSH） TELetypewriter NETwork、Secure SHell，登录到远程的计算机上来运行程序 网络管理（SNMP） Simple Network Management Protocol，在 TCP/IP 中进行网络管理，接受联网设备的信息通知、通知设置、故障通知，并进行远程修改配置、检查是否正常运行 使用 SNMP 管理的主机、网桥、路由器都称为 SNMP 代理（Agent），管理的那一端叫做管理器（Manager），SNMP 就是 Manager 与 Agent 之间用到的协议 管理端使用 MIB（Management Information Base）来访问代理端中保存的网络接口信息、通信数据量、异常数据量、设备温度等信息。在 TCP/IP 的网络管理中，SNMP 属于应用层协议，MIB 则属于表示层协议 TCP/IP 分层模型与通信示例 数据包首部 每个分层都会为数据附加首部，以包含该层必要的信息。首部就是为该层协议提供信息部分，数据就是该层要发送的内容，当然从下一层的角度看，上一层收到的包（由上一层的首部和上一层要发送的数据构成）整个被认为是本层的数据 发送数据包 甲给乙发送“早上好”的邮件： 应用程序处理：编码处理（相当于 OSI 的表示层功能） TCP 模块处理：根据应用指示负责建立连接、发送数据、断开连接，提供将应用层发来的数据顺利发送至对端的可靠传输，TCP 首部包含源和目标端口号、序号、校验和，然后将首部和数据一起发给 IP IP 模块处理：在 TCP 传来的整个数据前加上自己的首部，其中有发送端及接收端的 IP 地址，紧随 IP 首部的还有标识后面数据是 TCP 还是 UDP 的标识信息。IP 包生成后，参考路由控制表决定接受此 IP 包的路由或主机，随后发送给连接这些路由器或主机网络接口的驱动程序，以实现真正发送数据 若不知道接收端的 MAC 地址，可利用 ARP（Address Resolution Protocol）查找 网络接口（以太网驱动）的处理：以太网首部中包含发送端及接收端的 MAC 地址、以太网类型标识，数据通过物理层传输给接收端。发送处理中 FCS（Frame Check Sequence）由硬件计算，添加到包的最后，以判断数据包是否由于噪声而被破坏 经过数据链路的包 包（分组数据包）流动时从前向后一次被附加了以太网包首部、IP 包首部、TCP （或 UDP）包首部及应用自己的包首部，然后是数据，末尾追加了以太网包尾（Ethernet Trailer） 首部至少包含两个信息：发送端及接收端的地址、上一层的协议类型 数据包接收处理 发送流程的逆序过程 网络接口（以太网驱动）的处理：从以太网包首部中找到 MAC 地址判断是否为自己，不是则丢弃。若是自己则根据数据类型将数据传给对应子程序，如标识为 IP 包则给处理 IP 的子程序，如果是 ARP 则把数据交给 ARP 处理，如果无法识别的协议类型则丢弃 IP 模块的处理：类似上述，判断 IP 地址是否为自己，再根据其中的上层协议标识交给对应的上层程序。对于路由器来说接收端一般不是自己，则借助路由控制表找出该发送的主机或路由器后将数据发送出去 TCP 模块的处理：计算校验和以判断数据是否被破坏，然后检查是否在按照序号接收数据，然后检查端口号以确定应用程序。接收后返回一个确认信息给发送端，如果此信息没能被收到，发送端就一直反复发送。数据完整接收后会传给应用程序 应用程序处理：根据邮件地址确认是否为乙的地址，然后进行右键保存、显示等等处理，地址错误、保存失败等都会返回异常给发送端 powered by Gitbook更新时间： 2020-09-09 13:58:59 "},"md-note/03-data_link.html":{"url":"md-note/03-data_link.html","title":"第 3 章 数据链路","keywords":"","body":"第 3 章 数据链路 主要数据链路类型及其特点： 数据链路的作用 TCP/IP 没有对数据链路层及以下做定义，认为这两层的功能是透明的，但想要深入理解 TCP/IP 与网络就需要数据链路的知识 数据链路层的协议定义了通过通信媒介互联的设备之间传输的规范。通信媒介有双绞线电缆、同轴电缆、光纤、电波、红外线等介质，另外设备间也会通过交换机、网桥、中继器等中转数据 计算使用二进制表示信息，实际的通信媒介使用电压高低、灯山灭、电波强弱等表示信息，这两种信息之间的转换正是物理层的责任。数据链路层处理的数据也不是单纯的 0、1 序列，而是将他们集合为一个叫做“帧”的数据块后进行传输 可将数据链路视为网络传输中的最小单位，互联网可以称为“数据链路的集合” 数据链路的段 指一个被分割的网络，观察角度不同其范围也不同 例如使用中继器将两条网线组成一个网络，从网络层（逻辑上）看，两条网线属于一个网络，是一个段；从物理层看，两条网线分属于两个段 网络拓扑（Topology） 指网络的连接和构成的形态，有总线型、环形、星型、网状型等，目前实际的网络都是由这些简单的拓扑结构错综复杂的组合而成的 拓扑一词既可用于描述物理上的配线方式，也可描述逻辑上的网络结构 数据链路相关技术 MAC 地址 MAC 地址用于识别数据链路中互连的节点 以太网、FDDI、ATM、无线 LAN、蓝牙等都是根据 IEEE 的相关协议规范使用 MAC 地址的 FDDI，Fiber Distributed Data Interface，光纤分布式数据接口 ATM，Asynchronous Transfer Mode，异步传输模式。以信元为基础的一种分组交换和复用技术，面向连接的传输模式，高速数据传输率，支持多种类型（声音、数据、传真、CD、视频等等） IEEE，美国电气和电子工程师协会，也可读作“I triple E”，IEEE802 是专门制定局域网标准化相关规范的组织，如 IEEE802.3 是关于以太网的工作小组，具体的某个标准/协议则是在工作小组名后再加字母。 叫 802 是因为于 1980 年 2 月启动的局域网国际标准化项目 通过 MAC 地址判断目标地址： MAC 地址长 48 比特（6 字节，常用十六进制表示（此时长 12 个字符）），一般在全世界不重复。在使用网卡情况下，其一般被烧入到 ROM 中 ROM，Read-Only Memory，只读存储器。以非破坏性读出方式工作，只能读出无法写入，掉电后信息依然存在，也称为固定存储器 烧入，指将程序或数据写入到存储器中 最初用于一次性可编程只读存储器上，使用远高于正常读取电压的电压来强行改变内部物理结构实现程序写入，再用高电压将写入电路烧断保证无法二次写入。后来的一次性光盘也是用远高于正常读取功率的大功率来强行改变表面结构 随着技术发展，现代存储器一般可以多次写入，写入原理也不再是永久性改变，但烧这个词还是保留了 唯一性，只要不在一个数据链路中，MAC 地址重复也不会出现问题。如微机板是可以我们自己设置 MAC 地址的，如虚拟机的 MAC 地址也是虚拟软件自己设的，这就完全可能跟世界上某个 MAC 地址重复 IEEE802.3 规定的 MAC地址格式： 共享介质型网络 根据通信介质的使用方法分类，网络可分为共享介质型和非共享介质型 共享介质型指多个设备共享一个通信介质的网络，例如最早的以太网和 FDDI，设备之间使用同一个载波信道进行发送和接受。基本上采用半双工通信方式，并需要对介质进行访问控制。访问控制方式有争用方式和令牌传递方式 争用方式（Contention） 指争夺获取数据传输的权利的方式，也称 CSMA（Carrier Sense Multiple Access，载波监听多路访问） 各个站（数据链路中称节点为站）采用先到先得的方式占用信道发送数据 若多个站同时发送，则产生冲突，会导致网络拥堵和性能下降。 CSMA/CD Carrier Sense Multiple Access with Collision Detection 改良的 CSMA，在一部分以太网中使用 原理：要求各个站提前检查冲突，没有冲突则可以发送数据，如果在发送数据时检测到冲突，就发送一个特殊的 32 位的阻塞报文信号后立即停止发送，释放信道，随机延时一段时间后再重新争用介质。以同轴电缆为例，检查冲突是通过线路中的电压检测，一旦电压超出规定范围，就认为是发生了冲突 令牌传递方式 沿着令牌环发送称为令牌的特殊报文进行传输控制，仅持有令牌的站能发送数据 特点： 不会有冲突 每个站都有平等循环获得令牌的机会 网络拥堵也不会对性能下降，不过由于没有令牌不能发送数据，因此在网络不拥堵时数据链路的利用率达不到 100%，为此诞生了多种令牌传递技术以尽可能提高网络性能 令牌控制的数据传输: 非共享介质网络 不共享介质，对介质专用。每个站直连交换机，由交换机负责转发数据帧，发送端与接收端不共享通信介质，多采用全双工通信方式。如 ATM。非共享最近（书中）成为了以太网的主流方式。 用交换机构建网络，计算机与交换机端口（计算机设备的外部接口都叫做端口，注意区别于传输层协议的端口）一对一连接，即可实现全双工通信。不会发生冲突，因此通信更高效 缺点是交换机一旦故障则所有计算机之间都无法通信（所有星型体系共有的缺点） 半双工全双工 半双工指只发送或只接收的通信方式，全双工指同一时间即可发送也可接收数据的方式 根据 MAC 地址转发 交换集线器，使用集线器或集中器以星型连接多个主机，也叫以太网交换机，它就是具有多个端口的网桥，可以根据帧的目标 MAC 地址决定从哪个网络接口发送数据，这时参照的是转发表（Forwarding Table） 自学过程：转发表内容无需手动设置，可以自学。每个帧中包含发送方地址，将其与来源接口对应并记录到转发表中，以后再有到这个地址的即知道通过哪个接口发送。数据的目的地址若不在转发表中，则都发，谁接收了（只有数据的目的地址与自己相同，计算机才会接收数据），就记下接收的端口和目的地址的组合。这样就可以完成所有地址与端口对应的学习。 由于 MAC 地址没有层次性，当设备增多时转发表就变得更大，检索所需时长就更长，所以当连接较多终端时，有必要将网络分成多个数据链路，采用类似网络层的 IP 地址一样对地址分层管理 交换机转发方式：存储转发、直通转发 存储转发会检查帧末尾的 FCS 位，可以避免冲突、噪声导致的错误帧。直通转发延迟更短 环路检测技术 若网络中出现环路，最坏的情况下数据帧将在环路中持续转发，造成网络风暴导致网络瘫痪。生活中可将连接路由器的网线上的 4 对线对接来制造环路，瘫痪整个局域网，一般上层网络当将测到某子网有环路的话一般会断开与之的连接，避免影响更大的网络 解决环路有生成树和源路由两种方式，具有这些功能的网桥即使构建了环路也不会出现大问题。合适的环路可以分散网络流量，提高容灾能力 生成树 通过检查网络的结构、进制某些端口的使用可以有效消除环路。然而改端口可以作为发生问题时可绕行的端口 由 IEEE802.1D 定义，网桥必须在每 1~10 秒内互相交换 BPDU 包，判断端口的使用情况，以便消除环路。一旦发生故障，自动切换通信线路，使用没用着的端口继续传输，但切换需要几十秒时间，IEEE802.1W 定义了 RSTP 的方法以缩短切换时间 源路由 判断发送数据的源地址是由哪个网桥实现传输的，并将帧写入 RIF，因此可以根据这个 RIF 信息避免重复发送相同数据帧 VLAN 交换机按照端口区分多个网段的技术，即为 VLAN。可以区分广播数据传播的范围，减少网络负载，提高网络的安全性。并且在网管修改网络拓扑结构时也方便很多，无需进行硬件线路的改造了。 由于异构的两个网段之间需要具有路由功能的交换机，或者在各段中间通过路由器连接。此时使用的是 TAG VLAN 标准，它的每个网段都有一个标识 VLAN ID，数据帧首部要加上这个 VID 标识以表明数据是要发送给哪个网段的 以太网（Ethernet） Ethernet 源于 Ether（以太），意为介质。在爱因斯坦剔除量子力学前，人们普遍认为宇宙空间充满以太，并以波的形式传送光 众多数据链路中，以太网使用最广泛，规范简单，易于网卡即驱动程序实现 一半的以太网与 IEEE802.3 规范化的以太网在帧格式上有所不同，后者被称为 802.3 以太网 以太网连接形式 最初使用多台终端使用同一根同轴电缆的共享介质型连接方式，现在使用终端与交换机间独占电缆的方式 以太网分类 命名格式：BASE 如 10BASE2 表示速率为 10Mbps 使用同轴电缆，10GBASE-T 表示 10Gbps 速率使用双绞线 以太网中以时钟频率决定传输速度，1K = 1000，1M = 1000K，1G = 1000M 连接网络时，传输速度相同而电缆不同的情况下，可以使用允许不同传输介质的中继器或集线器。传输速度不同时，必须使用允许变速的设备如网桥、交换集线器、路由器 以太网历史 最初使用半双工通信，控制方式使用 CSMA/CD，后来这成为了限制以太网高速化的瓶颈，以至于人们一度想要放弃以太网 随着技术进步采用与交换机直接连接的方式，速度就上来了，现在以太网已成为最具兼容性与未来发展性的一种数据链路 以太网帧格式 依次为前导码、首部、数据、FCS 前导码（Preamble），在以太网帧的前端，由 1、0 交替组成的 64 位数据（其末尾 11 不是 10），表示一个以太网帧的开始，也是对端网卡能够确保与之同步的标志 前导码末尾的 11 称为 SDF（Start Frame Delimiter），表示之后是帧的本体 14 字节首部 = 【6 字节目标 MAC 地址】+【6 字节源 MAC 地址】+【2 字节上层协议类型】 数据范围为 46~1500 字节 FCS（Frame Check Sequence，帧检测序列）长 4 字节，其中保存着整个帧除以生成多项式的余数，具有较强的检错能力，接收端用同样方式计算后对比就可以检查帧是否损坏 与 802.3 以太网帧对比如下图，其中上层协议类型在 SNAP 中： 数据量路层再分层：介质访问控制层（Media Access Control，MAC）、逻辑链路控制层（Logical Link Control，LLC） 分别根据以太网、FDDI 等不同数据链路所特有和所共有的首部信息进行控制 另外带有 VLAN 标记的交换机之间以太网帧格式如下： 无线通信 通常使用电磁波、红外线、激光等，如办公室里的无线局域网，不需要网线或可见电缆 无线通信种类 根据通信距离可分为短距离无线（如 RFID）、无线 PAN（如蓝牙）、无线 LAN（如 WiFi）、无线 MAN、无线 RAN、无线 WAN（如 LTE、4G） IEEE802.11 802.11 定义了无线 LAN 使用无线 LAN 的风险 通过无线电波通信意味着在其通信范围内任何人都可以使用该无线 LAN，有着被盗听或篡改的风险 另外会受到其他通信设备的干扰，导致信号不稳定，例如微波炉就可以干扰使用 2.4GHz 带宽的 802.11b/g 设备（使用 IEEE802.11g 或 IEEE802.11g 标准的设备） 蓝牙 使用 2.4GHz 频率无线电波，通信终端最多允许 8 太设备，与 802.11b/g 设备同时使用时有可能导致通信性能的下降 ZigBee 主要用于设备远程控制的短距离、低功耗的无线通信技术，最多允许 65536 个终端之间相互通信，传输速度与所使用的频率有关 PPP 定义 Point-to-Point Protocol，点对点（1 对 1）连接计算机的协议，相当于 OSI 参考模型第 2 层的数据链路层的协议，是基于 HDLC（High Level Data Link Control Procedure，高级数据链路控制）制定的 以太网不仅与 OSI 第二层有关，还与第一层有关。而 PPP 不涉及任何物理层 可以使用电话线或 ISDN、专线、ATM 线路 人们使用有线电视通过 PPPoE（PPP over Ethernet）也可实现互联网接入，PPPoE 就是在以太网的数据中加入 PPP 帧进行传输 LCP、NCP 建立 PPP 连接后可以进行身份认证、压缩和加密 LCP（Link Control Protocol）不依赖上层，NCP（Network Control Protocol）依赖上层，上层为 IP 的 NCP 也叫 IPCP LCP 主要负责建立和断开连接、设置最大接收单元（Maximum Receive Unit，MRU）、设置验证协议（PAP 或 CHAP）、设置是否进行通信质量的监控 NCP 负责 IP 地址设置以及是否进行 TCP/IP 首部压缩等协商 PAP（Password Authentication Protocol）通过两次握手进行用户名和密码验证，密码以明文传输，有被窃听风险 CHAP（Challenge Handshake Authentication Protocol） 使用一次性密码 OTP（One Time Password），可以防止窃听，建立连接后还可以进行定期的密码交换以检验对端是否中途被替换 帧格式 标志码：区分每个帧，位于帧的前后，分别长 1 字节，内容为 01111110。标志码中间不允许出现连续 6 个以上的 1，每当出现 5 个 1 时，后面就要加一个 0。接收端每当收到 5 个 1 而后面是 0 时，就应该去掉这个 0。这套规则与 HDLC 完全相同 PPP 会给计算机带来大量负荷 使用电脑拨号时，插入、删除 0 的操作和 FCS 计算都由 CPU 处理 PPPoE 有些互联网接入服务商在以太网上利用 PPPoE 提供 PPP 功能 单纯的以太网没有验证功能，也没用建立和断开连接的功能，无法按时计费，加入 PPP 后可以有效管理客户 其他数据链路 ATM Asynchronous Transfer Mode，以信元（5 字节首部 + 48字节数据）为单位进行数据传输的数据链路。线路占用时间短，能高效传输大容量数据，主要用于关于网络连接。由 ITU 和 ATM 论坛负责标准化 是面向连接的，允许同时与多个对端建立通信连接 无发送权限控制，允许在任何时候发送任何数据。但当大量计算机同时发送大量数据时可能引发网络拥堵进入收敛状态，为了防止这个现象，ATM 中增加了限制带宽的功能 收敛状态：当网络非常拥堵时，路由器或交换机无法完成包的处理，从而丢弃这些包的一种状态 同步和异步 同步：TDM（时分复用设备）在两端设备之间之间同步的同时，按照既定时间将帧分为若干个时隙，按照线路顺序发送给目标地址，即使没有要发送的数据，时隙也会占有着，线路利用率较低 异步：ATM 扩展了 TDM，在 TDM 的时隙中放入数据时，是按照数据到达的顺序放入的，提高了线路利用率。但这样需要更多地首部来区分顺序，增加了网络开销，因此也在一定程度上降低了通信速度 网络开销：在通信传输中，除了实际要发送的数据，还需要附加的一些控制信息所消耗的带宽信息以及处理这些信息所需的时间开销 ATM 的弊端 以太网中一个帧最大可传输 1500 字节，FDDI 最大可传输 4352 字节，而 ATM 一个信元只能发送固定的 48 字节数据，如果其中还包含 IP 首部和 TCP 首部，那基本就没啥上层数据了。因此不会单独使用 ATM，而是使用上层的 AAL，在上层为 IP 的情况下，叫做 AAL5，每个 IP 包被附加各层的协议首部以后，最多可以被分为 192 个信元 因此只要 192 个信元中只要有一个丢失，那么整个 IP 包都想度损坏，此时帧检查位报错，丢弃所有信元。TCP/IP 有重发机制，哪怕只有一个信元丢失也要重发全部 192 个信元。 由于 ATM 没有发送权限上的控制，很容易导致网络收敛，因此构建 ATM 网络时必须要保证终端的带宽合计小雨主干网的带宽，还要尽量保证信元不易丢失 POS Packet over SDH/SONET 一种在 SDH（SONET） 上进行包通信的协议 SDH（SONET）是在光纤上传输数字信号的物理层规范，SDH 作为利用电话线或专线等可靠性较高的方式进行光传输的网络，正被广泛应用 SDH：Synchronous Digital Hierarchy，同步数字体系 SONET：Synchronous Optical NETwork，同步光纤网络 FDDI Fiber Distributed Data Interface，分布式光纤数据接口 采用令牌环的访问方式。每个站通过光纤连接成环状，为了防止某处环断开导致通信终端而使用双环的结构。 令牌环访问方式在网络拥堵时极易导致网络收敛 Token Ring 令牌环网。 源自 IBM 开发的令牌环 LAN 技术，可实现 4Mbps 或 16Mbps 的传输速率。FDDI 就是扩展了 Token Ring 的产物 由于以太网的广泛普及，令牌环已基本无人使用 光纤通道 Fiber Channel 实现高速数据通信的数据链路，速率可达 133Mbps~4Gbps HIPPI 用于连接超大型计算机 HDMI High-Definition Multimedia Interface，高清晰度多媒体接口 可以通过一根缆线实现图像和声音等数字信号的高品质传输 2009 年发布的 1.4 版本开始它可以传输以太网帧，采用 HDMI 介质实现 TCP/IP 通信也是可能的了 高速 PLC Power Line Communication 利用电力线上数 MHz~数十 MHz 频带范围，实现数十 Mbps~200Mbps 传输速率 易受电波干扰，一般用于室内 公共网络 公共通信服务：如电信运行商提供的电话网络 模拟电话线路 利用固定电话线路进行通信。 计算机与电话线相连需能转换数字信号与模拟型号的调制解调器（Modem，犹豫其发音而俗称“猫”） 移动通信服务 如手机通信、小灵通 ADSL 通过模拟电话线路传输时，只有发送音频信号才能显现，其他的都丢弃，速度也低。ADSL 就是用过分离器将音频信号（低频）和数字信号（高频）分离开以实现高速传输的技术 还有其他的 VDSL、HDSL 等，统称为 xDSL FTTH Fiber To The Home，光纤到户 使用负责转换光电信号的 ONU、OLT 来连接计算机，可以实现稳定的高速通信 还有种方式是光纤到楼，楼内在通过布线实现联网，简称 FTTB（Fiber To The Building） 有线电视 电视最初使用无线电波发送信号（大锅），后来使用线缆。 利用线缆的空闲频道可以实现接入互联网的功能 专线 一对一的连接 VPN 虚拟专用网络，用于连接距离较远的地域，包括 IP-VPN 和广域以太网 IP-VPN 在 IP 网络（互联网）上建立 VPN 网络服务商提供一种在 IP 网络上使用 MPLS（Multiprotocol Label Switching，多协议标签交换）技术构建 VPN 的服务。MPLS 在 IP 包中附加一个标签进行传输控制，每个用户标签信息不同。可以形成虚拟的封闭私有网络，能进行用户级别的带宽控制 企业也可以在互联网上建立自己的 VPN，一般采用 IPsec 技术。该技术对 VPN 中的 IP 包进行验证和加密，在互联网上构造一个封闭的私有网络 广域以太网 服务提供商所提供的用于连接相距较远的地域的服务，是在作为数据链路层的以太网上利用 VLAN（虚拟局域网）实现 VPN 的技术 公共无线 LAN 其他公共无线通信服务 X.25、帧中继、ISDN，都没啥人用了 powered by Gitbook更新时间： 2020-09-10 18:11:30 "}}